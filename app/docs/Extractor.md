┌────────────────────┐
│   File Upload      │
│ (PDF/JPG/DOCX/PNG) │
└─────────┬──────────┘
          │
          ▼
┌────────────────────────────┐
│ Chuyển đổi thành list ẢNH  │
│ (pdf2image, docx2txt+PIL)  │
└─────────┬──────────┬───────┘
          │          │
  (song song xử lý nhiều trang)
          │          │
          ▼          ▼
 ┌─────────────────────────────┐
 │    Xử lý song song từng     │
 │    Ảnh/Trang (ThreadPool)   │
 └─────────┬──────────┬────────┘
           │          │
           │  ┌──────────────────────────────────────────────────────┐
           │  │   (Trong mỗi thread/ảnh)                             │
           │  │     - Crop bảng (table region)                       │
           │  │     - Crop số định danh (ID region)                  │
           │  │     - Crop body (nội dung chính không có ID)         │
           │  │ (Có thể song song tiếp các bước này nếu độc lập)     │
           │  └──────────────────────────────────────────────────────┘
           │          │
           │          ▼
           │  ┌─────────────────────────────────────┐
           │  │  OCR các vùng crop:                 │
           │  │   - OCR bảng (PaddleOCR)            │
           │  │   - OCR số định danh (PaddleOCR)    │
           │  │   - OCR body (Tesseract/PaddleOCR)  │
           │  │ (Có thể batch OCR các ô bảng)       │
           │  └─────────────────────────────────────┘
           │          │
           │          ▼
           │  ┌─────────────────────────────────────────┐
           │  │   Tổng hợp text:                        │
           │  │   [ID OCR] + [Body OCR] + [Table OCR]   │
           │  └─────────────────────────────────────────┘
           │          │
           ▼          │
┌─────────────────────────────────────────┐
│   Ghép kết quả text của các trang       │
└─────────┬───────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────┐
│   Đưa qua LLM (nếu có) để extract       │
│   dữ liệu cấu trúc                      │
└─────────┬───────────────────────────────┘
          │
          ▼
┌──────────────────────────────────────────┐
│  Trả về text trích xuất + trường dữ liệu │
└──────────────────────────────────────────┘
